@model DigitalArena.Models.Custom.SellerDetailsViewModel

@{
    ViewBag.Title = "Seller Details";

    Func<DateTime?, string> formatDate = date =>
        date.HasValue && date.Value != DateTime.MinValue
            ? date.Value.ToString("dd MMMM, yyyy hh:mm tt")
            : "N/A";

    Func<string, string> formatPhone = phone =>
    {
        if (string.IsNullOrEmpty(phone)) return "N/A";
        phone = phone.Trim();
        if (phone.StartsWith("+88")) phone = phone.Substring(3);
        else if (phone.StartsWith("88")) phone = phone.Substring(2);
        return phone.Length == 11
            ? $"{phone.Substring(0, 5)}-{phone.Substring(5)}"
            : phone;
    };
}

<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb bg-white px-3 py-2 rounded shadow-sm">
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index", "AdminDashboard")" class="text-decoration-none text-dark">Admin</a>
        </li>
        <li class="breadcrumb-item">
            <a href="@Url.RouteUrl("ManageSellersRoute")" class="text-decoration-none text-dark">Manage Sellers</a>
        </li>
        <li class="breadcrumb-item active text-primary" aria-current="page">
            Seller Details
        </li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-2">
    <h1 class="fw-bold text-primary mb-0">Seller Details</h1>
    <button type="button"
            class="btn btn-sm btn-outline-secondary"
            onclick="openSellerStatusModal(@Model.Seller.UserId, @(Model.Seller.IsActive.ToString().ToLower()))">
        <i class="bi bi-pencil-square me-1"></i> Change Status
    </button>
</div>

<div class="card shadow-sm p-4">
    <div class="row mb-3">
        <div class="col-md-2 text-center">
            <img src="@Url.Content(!string.IsNullOrEmpty(Model.Seller.ProfileImage)
                ? $"~/Assets/user_profile_image/user_{Model.Seller.UserId}/{Model.Seller.ProfileImage}"
                : "~/Assets/user_profile_image/avatar.jpg")"
                 class="img-thumbnail rounded-circle"
                 alt="Profile Image"
                 width="100"
                 height="100" />
        </div>
        <div class="col-md-10 d-flex flex-column justify-content-center">
            <h4>@Model.Seller.FullName</h4>
            <p class="text-muted mb-1">Username: <strong>@Model.Seller.Username</strong></p>
            <p class="text-muted mb-0">Role: <span class="badge bg-info text-dark">@Model.Seller.Role</span></p>
        </div>
    </div>

    <dl class="row">
        <dt class="col-sm-3">Email</dt>
        <dd class="col-sm-9">@Model.Seller.Email</dd>

        <dt class="col-sm-3">Phone</dt>
        <dd class="col-sm-9">@formatPhone(Model.Seller.Phone)</dd>

        <dt class="col-sm-3">Status</dt>
        <dd class="col-sm-9">
            @if (Model.Seller.IsActive)
            {
                <span class="badge bg-success">Active</span>
            }
            else
            {
                <span class="badge bg-secondary">Inactive</span>
            }
        </dd>

        <dt class="col-sm-3">Created At</dt>
        <dd class="col-sm-9">@formatDate(Model.Seller.CreatedAt)</dd>

        <dt class="col-sm-3">Last Login</dt>
        <dd class="col-sm-9">@formatDate(Model.Seller.LastLoginAt)</dd>
    </dl>


    <h5 class="mb-3">Seller Statistics</h5>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="border rounded p-3 bg-light text-center shadow-sm">
                <h6 class="text-muted mb-1">Total Products</h6>
                <h3 class="text-primary fw-bold">@Model.ProductCount</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="border rounded p-3 bg-light text-center shadow-sm">
                <h6 class="text-muted mb-1">Total Paid Orders</h6>
                <h3 class="text-success fw-bold">@Model.TotalOrders</h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="border rounded p-3 bg-light text-center shadow-sm">
                <h6 class="text-muted mb-1">Total Revenue</h6>
                <h3 class="text-warning fw-bold">@($"{Model.TotalRevenue:0.00} BDT")</h3>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="border rounded p-3 bg-light text-center shadow-sm">
                <h6 class="text-muted mb-1">Total Approved Reviews</h6>
                <h3 class="text-info fw-bold">@Model.TotalReviews</h3>
            </div>
        </div>
        <div class="col-md-6">
            <div class="border rounded p-3 bg-light text-center shadow-sm">
                <h6 class="text-muted mb-1">Average Rating</h6>
                <h3 class="text-secondary fw-bold">
                    @Model.AverageRating @if (Model.AverageRating > 0)
                    {<small class="text-muted">/ 5</small>}
                </h3>
            </div>
        </div>
    </div>




    <hr class="my-4" />

    <h5 class="mb-3">More Information</h5>

    <div class="d-flex flex-wrap gap-2">
        <a href="@Url.RouteUrl("ViewSellerProductsRoute", new { userId = Model.Seller.UserId })" class="btn btn-outline-primary">
            <i class="bi bi-box-seam me-1"></i> View Products
        </a>

        <a href="@Url.RouteUrl("ViewSellerProductReviewsRoute", new { userId = Model.Seller.UserId })" class="btn btn-outline-info">
            <i class="bi bi-star me-1"></i> View Reviews
        </a>
    </div>

    <a href="@Url.RouteUrl("ManageSellersRoute")" class="btn btn-secondary mt-3">Back to Seller List</a>
</div>



<!-- Change Seller Status Modal -->
<div class="modal fade" id="sellerStatusModal" tabindex="-1" aria-labelledby="sellerStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <form method="post" action="@Url.Action("UpdateSellerStatus", "ManageSeller")">
                <div class="modal-header">
                    <h5 class="modal-title" id="sellerStatusModalLabel">Change Seller Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="userId" id="modalSellerUserId" />
                    <div class="mb-3">
                        <label for="modalSellerStatus" class="form-label">New Status</label>
                        <select name="newStatus" id="modalSellerStatus" class="form-select">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer pt-0">
                    <button type="submit" class="btn btn-primary btn-sm">Update</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
    function openSellerStatusModal(userId, isActive) {
        document.getElementById("modalSellerUserId").value = userId;
        document.getElementById("modalSellerStatus").value = isActive;
        var modal = new bootstrap.Modal(document.getElementById("sellerStatusModal"));
        modal.show();
    }
</script>
