@model List<DigitalArena.Models.UserModel>

@{
    ViewBag.Title = "Buyers List";
}

<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb bg-white px-3 py-2 rounded shadow-sm">
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index", "AdminDashboard")" class="text-decoration-none text-dark">Admin</a>
        </li>
        <li class="breadcrumb-item active text-primary" aria-current="page">
            Manage Buyers
        </li>
    </ol>
</nav>

<h1 class="mb-1 fw-bold text-primary">Buyers Management</h1>
<p class="text-muted mb-4">Browse and manage all registered buyers</p>


<div class="table-responsive">
    @*Search and Filtering Options*@
    <div class="row mb-3 g-3 align-items-end">
        <div class="col-md-4">
            <label for="searchTerm" class="form-label">Search</label>
            <input id="searchTerm" class="form-control" placeholder="Username, Email, Name" />
        </div>
        <div class="col-md-3">
            <label for="statusFilter" class="form-label">Status</label>
            <select id="statusFilter" class="form-select">
                <option value="">All</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
        </div>
        <div class="col-md-2 d-flex align-items-center">
            <button id="clearFilters" class="btn btn-outline-secondary w-100">Clear Filters</button>
        </div>
    </div>

    <div id="buyersTableContainer">
        @Html.Partial("_BuyersTable", Model)
    </div>

</div>

<a href="@Url.Action("Index", "AdminDashboard")" class="btn btn-secondary mt-3">Back to Dashboard</a>

@section scripts {
    <script>
    $(document).ready(function () {
        let timer;

        $('#searchTerm, #statusFilter').on('input change', function () {
            clearTimeout(timer);
            timer = setTimeout(fetchFilteredBuyers, 400);
        });

        $('#clearFilters').on('click', function (e) {
            e.preventDefault();
            // Reset filters to default
            $('#searchTerm').val('');
            $('#statusFilter').val('');
            fetchFilteredBuyers(1); // Fetch first page with default filters
        });

        function fetchFilteredBuyers(page = 1) {
            $.get('@Url.RouteUrl("ManageBuyersRoute")', {
                page,
                search: $('#searchTerm').val(),
                status: $('#statusFilter').val()
            }).done(function (data) {
                $('#buyersTableContainer').html(data);
            });
        }

        // Pagination links AJAX
        $(document).on('click', '.pagination a.page-link', function (e) {
            e.preventDefault();
            const page = $(this).data('page');
            fetchFilteredBuyers(page);
        });
    });
    </script>
}
