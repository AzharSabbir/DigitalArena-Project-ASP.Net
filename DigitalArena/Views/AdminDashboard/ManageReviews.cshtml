@model List<DigitalArena.DBContext.Review>

@{
    ViewBag.Title = "Reviews List";
}

<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb bg-white px-3 py-2 rounded shadow-sm">
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index", "AdminDashboard")" class="text-decoration-none text-dark">Admin</a>
        </li>
        <li class="breadcrumb-item active text-primary" aria-current="page">
            Manage Reviews
        </li>
    </ol>
</nav>

<h1 class="mb-1 fw-bold text-primary">Reviews Management</h1>
<p class="text-muted mb-4">Browse and manage all product reviews</p>

<div class="table-responsive">
    <div class="row mb-3 g-3 align-items-end">
        <div class="col-md-3">
            <label for="search" class="form-label">Search Buyer</label>
            <input id="search" class="form-control" placeholder="Buyer Username" />
        </div>
        <div class="col-md-2">
            <label for="status" class="form-label">Status</label>
            <select id="status" class="form-select">
                <option value="">All</option>
                <option value="Approved">Approved</option>
                <option value="Pending">Pending</option>
                <option value="Rejected">Rejected</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="fromDate" class="form-label">From Date</label>
            <input id="fromDate" type="date" class="form-control" />
        </div>
        <div class="col-md-2">
            <label for="toDate" class="form-label">To Date</label>
            <input id="toDate" type="date" class="form-control" />
        </div>
        <div class="col-md-3 d-flex align-items-center">
            <button id="clearFilters" class="btn btn-outline-secondary w-100">Clear Filters</button>
        </div>
    </div>

    <div id="reviewsContainer">
        @Html.Partial("_ManageReviewsPartial", Model)
    </div>
</div>

<a href="@Url.Action("Index", "AdminDashboard")" class="btn btn-secondary mt-3">Back to Dashboard</a>

@section scripts {
    <script>
        $(document).ready(function () {
            let timer;

            $('#search, #status, #fromDate, #toDate').on('input change', function () {
                clearTimeout(timer);
                timer = setTimeout(fetchFilteredReviews, 400);
            });

            $('#clearFilters').on('click', function (e) {
                e.preventDefault();
                $('#search').val('');
                $('#status').val('');
                $('#fromDate').val('');
                $('#toDate').val('');
                fetchFilteredReviews(1);
            });

            function fetchFilteredReviews(page = 1) {
                $.get('@Url.RouteUrl("ManageReviewsRoute")', {
                    page,
                    search: $('#search').val(),
                    status: $('#status').val(),
                    fromDate: $('#fromDate').val(),
                    toDate: $('#toDate').val()
                }).done(function (data) {
                    $('#reviewsContainer').html(data);
                });
            }

            $(document).on('click', '.pagination a.page-link', function (e) {
                e.preventDefault();
                const page = $(this).data('page');
                fetchFilteredReviews(page);
            });
        });
    </script>
}
