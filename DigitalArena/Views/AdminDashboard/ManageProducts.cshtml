@model List<DigitalArena.DBContext.Product>

@{
    ViewBag.Title = "Products List";
}

<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb bg-white px-3 py-2 rounded shadow-sm">
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index", "AdminDashboard")" class="text-decoration-none text-dark">Admin</a>
        </li>
        <li class="breadcrumb-item active text-primary" aria-current="page">
            Manage Products
        </li>
    </ol>
</nav>

<h1 class="mb-1 fw-bold text-primary">Products Management</h1>
<p class="text-muted mb-4">Browse and manage all products</p>

<div class="table-responsive">
    <div class="row mb-3 g-3 align-items-end">
        <div class="col-md-3">
            <label for="searchTerm" class="form-label">Search Product</label>
            <input id="searchTerm" class="form-control" placeholder="Product Name or Description" />
        </div>
        <div class="col-md-3">
            <label for="sellerSearch" class="form-label">Search Seller</label>
            <input id="sellerSearch" class="form-control" placeholder="Seller Username" />
        </div>
        <div class="col-md-2">
            <label for="statusFilter" class="form-label">Status</label>
            <select id="statusFilter" class="form-select">
                <option value="">All</option>
                <option value="Pending">Pending</option>
                <option value="Approved">Approved</option>
                <option value="Rejected">Rejected</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="categoryFilter" class="form-label">Category</label>
            <select id="categoryFilter" class="form-select">
                <option value="">All Categories</option>
                @foreach (var cat in ViewBag.Categories as List<DigitalArena.DBContext.Category>)
                {
                    <option value="@cat.CategoryId">@cat.Name</option>
                }
            </select>
        </div>
        <div class="col-md-2 d-flex align-items-center">
            <button id="clearFilters" class="btn btn-outline-secondary w-100">Clear Filters</button>
        </div>
    </div>

    <div id="productsTableContainer">
        @Html.Partial("_ProductsTable", Model)
    </div>
</div>

<a href="@Url.Action("Index", "AdminDashboard")" class="btn btn-secondary mt-3">Back to Dashboard</a>

@section scripts {
    <script>
        $(document).ready(function () {
            let timer;

            $('#searchTerm, #sellerSearch, #statusFilter, #categoryFilter').on('input change', function () {
                clearTimeout(timer);
                timer = setTimeout(fetchFilteredProducts, 400);
            });

            $('#clearFilters').on('click', function (e) {
                e.preventDefault();
                $('#searchTerm').val('');
                $('#sellerSearch').val('');
                $('#statusFilter').val('');
                $('#categoryFilter').val('');
                fetchFilteredProducts(1);
            });

            function fetchFilteredProducts(page = 1) {
                $.get('@Url.RouteUrl("ManageProductsRoute")', {
                    page,
                    search: $('#searchTerm').val(),
                    sellerSearch: $('#sellerSearch').val(),
                    status: $('#statusFilter').val(),
                    categoryId: $('#categoryFilter').val()
                }).done(function (data) {
                    $('#productsTableContainer').html(data);
                });
            }

            $(document).on('click', '.pagination a.page-link', function (e) {
                e.preventDefault();
                const page = $(this).data('page');
                fetchFilteredProducts(page);
            });
        });
    </script>

}
